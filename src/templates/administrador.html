{% extends "base.html" %}

{% block title %}Administrador{% endblock %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
<section class="section">
    <h2>Bienvenido</h2>
    <p>Sección exclusiva para administradores.</p>
    <p>Aquí podras visualizar y modificar las horas de los pacientes</p>
</section>
<style>
    .section {
        max-width: 1000px;
    }
    .contenedor{
        display: flex;
        justify-content: space-between;
    }
    .seleccion {
        background-color: rgb(170, 220, 247);
    }
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgb(0,0,0);
        background-color: rgba(0,0,0,0.4);
        justify-content: center;
        align-items: center;
        animation: fadeIn 0.3s forwards;
    }
    .modal-content {
        background-color: #fefefe;
        margin: 15% auto;   
        padding: 30px;
        border-radius: 12px;
        width: 400px;
        height: 350px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        position: relative;
        transform: translateY(20px);
        animation: slideUp 0.5s ease-out forwards;        
    }
    .close {
        color: #aaa;
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 30px;
        font-weight: bold;
        cursor: pointer;
    }
    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }
</style>
<div class="contenedor">
    <section class="section">
        <h2>Lista de horas</h2>
        <div id="lista"></div>
        <div style="width: 800px;"></div>
        <script>
            var listaEl = document.getElementById('lista');
            var lista = new FullCalendar.Calendar(listaEl, {
                locale: 'es',
                initialView: 'listDay',
                headerToolbar: {
                    left: 'prev,next',
                    center: 'title',
                    right: 'botonañadirevento'
                },
                customButtons: {
                    botonañadirevento: {
                        text: 'Agendar hora',
                        click: function() {
                            modal.style.display = "block";
                        }
                    }
                },
                eventClick: function(info) {
                    if (confirm(`¿Deseas eliminar el evento "${info.event.title}"?`)) {
                        info.event.remove();
                        removeEvent(info.event);
                    }
                }
            });
            lista.render();

        </script>
    </section>
    <section class="section">
        <h2>Calendario</h2>
        <div id="calendario"></div>
        <div style=" width: 700px;"></div>
        <script>
            var calendarEl = document.getElementById('calendario');
            var calendario = new FullCalendar.Calendar(calendarEl,{
                locale: 'es',
                dateClick: function(info) {
                    lista.gotoDate(info.dateStr);
                    let highlightedDates = document.querySelectorAll('.seleccion');
                    highlightedDates.forEach(function(date) {
                        date.classList.remove('seleccion');
                    });
                    info.dayEl.classList.add('seleccion');
                    selectedDate = info.dateStr;
                },
                height: 800});
            calendario.render();
        </script>
    </section>
</div>
<section class = "section">
    <sect id="eventModal" class="modal">
        <div class="modal-content">
        <div align="center">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Agendar Hora</h2>
            <form id="eventForm">
                <div>
                    <label for="rut">RUT:</label>
                    <input type="text" id="rut" name="rut" required>
                </div>
                <div>
                    <label for="nombre">Nombre:</label>
                    <input type="text" id="nombre" name="nombre" required>
                </div>
                <div>
                    <label for="mail">Correo Electrónico:</label>
                    <input type="email" id="mail" name="mail" required>
                </div>
                <div>
                    <label for="numer">Teléfono:</label>
                    <input type="tel" id="number" name="number" required>
                </div>
                <div>
                    <label for="edad">Edad:</label>
                    <input type="number" id="edad" name="edad" required>
                </div>
                <div>
                    <label for="hora">Hora:</label>
                    <input type="time" id="hora" name="hora" required>
                </div>
                <div>
                    <label for="especialista">Especialista:</label>
                    <input type="text" id="especialista" name="especialista" required>
                </div>
                <button type="submit" class="reserve-button">Enviar</button>
            </form>
        </div>
    </div>
</section>
<script>
    var modal = document.getElementById("eventModal");
    var btn = document.getElementById("botonañadirevento");
    var span = document.getElementsByClassName("close")[0];
    var form = document.getElementById("eventForm");

    btn.onclick = function() {
        modal.style.display = "block";
    }

    span.onclick = function() {
        modal.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    form.onsubmit = function(event) {
        event.preventDefault();
        var rut = document.getElementById("rut").value;
        var nombre = document.getElementById("nombre").value;
        var mail = document.getElementById("mail").value;
        var numero = document.getElementById("number").value;
        var edad = document.getElementById("edad").value;
        var hora = document.getElementById("hora").value;
        var especialista = document.getElementById("especialista").value;
        
        //var selectedDate = new Date().toISOString().split('T')[0];
        if (true) {
            let event = {
                title: "prueba",
                start: "2024-04-12",
                //start: `${selectedDate}T${time}`,
                allDay: true
            };
            lista.addEvent(event);
            saveEvent(event);
            modal.style.display = "none";
        } else {
            alert('Por favor, selecciona una fecha en el calendario primero.');
        }
    }

    function saveEvent(event) {
        let events = JSON.parse(localStorage.getItem('events')) || [];
        events.push(event);
        localStorage.setItem('events', JSON.stringify(events));
    }

    function loadEvents() {
        let events = JSON.parse(localStorage.getItem('events')) || [];
        events.forEach(function(event) {
            lista.addEvent(event);
        });
    }

    function removeEvent(event) {
        let events = JSON.parse(localStorage.getItem('events')) || [];
        events = events.filter(e => e.title !== event.title || e.start !== event.start);
        localStorage.setItem('events', JSON.stringify(events));
    }

    function closeModal() {
        var modal = document.getElementById("eventModal");
        modal.style.display = "none";
    }

    loadEvents();
</script>
{% endblock %}